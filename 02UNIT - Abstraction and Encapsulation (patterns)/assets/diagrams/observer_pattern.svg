<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 450" width="750" height="450">
  <defs>
    <style>
      .title { font: bold 18px sans-serif; fill: #58a6ff; }
      .class-name { font: bold 14px monospace; fill: #ffffff; }
      .method { font: 12px monospace; fill: #8b949e; }
      .stereotype { font: italic 11px sans-serif; fill: #79c0ff; }
      .arrow { stroke: #58a6ff; stroke-width: 2; fill: none; }
      .event-arrow { stroke: #3fb950; stroke-width: 2; fill: none; }
      .arrow-head { fill: #58a6ff; }
      .event-head { fill: #3fb950; }
      .dashed { stroke-dasharray: 5,5; }
      .box { fill: #161b22; stroke: #30363d; stroke-width: 2; rx: 5; }
      .interface-box { fill: #0d1117; stroke: #58a6ff; stroke-width: 2; rx: 5; }
      .label { font: 11px sans-serif; fill: #8b949e; }
      .event-label { font: 11px sans-serif; fill: #3fb950; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#58a6ff"/>
    </marker>
    <marker id="eventhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3fb950"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="750" height="450" fill="#0d1117"/>
  
  <!-- Title -->
  <text x="375" y="30" text-anchor="middle" class="title">Observer Pattern: Simulation Event Handling</text>
  
  <!-- Subject (Observable) -->
  <rect x="280" y="60" width="190" height="120" class="interface-box"/>
  <text x="375" y="80" text-anchor="middle" class="stereotype">«Generic»</text>
  <text x="375" y="100" text-anchor="middle" class="class-name">Observable[T]</text>
  <line x1="290" y1="110" x2="460" y2="110" stroke="#58a6ff" stroke-width="1"/>
  <text x="290" y="130" class="method">- observers: list[Callable]</text>
  <line x1="290" y1="140" x2="460" y2="140" stroke="#58a6ff" stroke-width="1"/>
  <text x="290" y="160" class="method">+ subscribe(callback)</text>
  <text x="290" y="175" class="method">+ unsubscribe(callback)</text>
  <text x="290" y="190" class="method">+ notify(value: T)</text>
  
  <!-- Observer Protocol -->
  <rect x="280" y="230" width="190" height="70" class="interface-box"/>
  <text x="375" y="250" text-anchor="middle" class="stereotype">«Protocol»</text>
  <text x="375" y="270" text-anchor="middle" class="class-name">Observer[T]</text>
  <line x1="290" y1="280" x2="460" y2="280" stroke="#58a6ff" stroke-width="1"/>
  <text x="290" y="295" class="method">+ update(value: T) → None</text>
  
  <!-- Arrow from Observable to Observer -->
  <line x1="375" y1="180" x2="375" y2="230" class="arrow"/>
  <polygon points="375,225 370,215 380,215" class="arrow-head"/>
  <text x="385" y="210" class="label">notifies</text>
  
  <!-- Concrete Observers -->
  <!-- ConsoleLogger -->
  <rect x="50" y="350" width="160" height="80" class="box"/>
  <text x="130" y="375" text-anchor="middle" class="class-name">ConsoleLogger</text>
  <line x1="60" y1="385" x2="200" y2="385" stroke="#30363d" stroke-width="1"/>
  <text x="60" y="405" class="method">+ prefix: str</text>
  <text x="60" y="420" class="method">+ update(value)</text>
  
  <!-- MetricsCollector -->
  <rect x="280" y="350" width="190" height="80" class="box"/>
  <text x="375" y="375" text-anchor="middle" class="class-name">MetricsCollector</text>
  <line x1="290" y1="385" x2="460" y2="385" stroke="#30363d" stroke-width="1"/>
  <text x="290" y="405" class="method">+ count, mean, min, max</text>
  <text x="290" y="420" class="method">+ update(value)</text>
  
  <!-- ProgressBar -->
  <rect x="540" y="350" width="160" height="80" class="box"/>
  <text x="620" y="375" text-anchor="middle" class="class-name">ProgressBar</text>
  <line x1="550" y1="385" x2="690" y2="385" stroke="#30363d" stroke-width="1"/>
  <text x="550" y="405" class="method">+ total: int</text>
  <text x="550" y="420" class="method">+ update(value)</text>
  
  <!-- Implements arrows -->
  <line x1="130" y1="350" x2="310" y2="300" class="arrow dashed"/>
  <polygon points="310,300 300,305 303,295" class="arrow-head"/>
  
  <line x1="375" y1="350" x2="375" y2="300" class="arrow dashed"/>
  <polygon points="375,300 370,310 380,310" class="arrow-head"/>
  
  <line x1="620" y1="350" x2="440" y2="300" class="arrow dashed"/>
  <polygon points="440,300 447,305 450,295" class="arrow-head"/>
  
  <!-- Event flow illustration -->
  <rect x="540" y="60" width="170" height="100" fill="#1a472a" stroke="#3fb950" rx="5"/>
  <text x="625" y="85" text-anchor="middle" class="event-label">Event Flow</text>
  <text x="550" y="110" class="method" fill="#3fb950">1. state changes</text>
  <text x="550" y="130" class="method" fill="#3fb950">2. notify(new_value)</text>
  <text x="550" y="150" class="method" fill="#3fb950">3. observers.update()</text>
  
  <!-- Simulation box -->
  <rect x="40" y="60" width="160" height="80" class="box"/>
  <text x="120" y="85" text-anchor="middle" class="class-name">Simulation</text>
  <line x1="50" y1="95" x2="190" y2="95" stroke="#30363d" stroke-width="1"/>
  <text x="50" y="115" class="method">+ events: Observable</text>
  <text x="50" y="130" class="method">+ step(dt)</text>
  
  <!-- Arrow from Simulation to Observable -->
  <line x1="200" y1="100" x2="280" y2="120" class="arrow"/>
  <polygon points="280,120 270,117 272,127" class="arrow-head"/>
  <text x="230" y="100" class="label">owns</text>
  
</svg>
