@startuml validation_layers

!theme plain
skinparam backgroundColor #FFFFFF
skinparam componentBackgroundColor #F8F9FA
skinparam componentBorderColor #6C757D
skinparam arrowColor #0D6EFD
skinparam noteBackgroundColor #FFF3CD

title Defensive Programming: Validation Layers

package "External Boundary" {
    [User Input] as UI
    [API Request] as API
    [File Input] as FI
}

package "Validation Layer" <<Rectangle>> {
    [Type Validation] as TV
    [Range Validation] as RV
    [Format Validation] as FV
    [Semantic Validation] as SV
}

package "Business Logic" <<Rectangle>> {
    [Core Functions] as CF
    [Assertions] as AS
    [Postconditions] as PC
}

package "Data Layer" <<Rectangle>> {
    [Database] as DB
    [File System] as FS
    [External APIs] as EA
}

UI --> TV
API --> TV
FI --> TV

TV --> RV : valid type
RV --> FV : in range
FV --> SV : correct format
SV --> CF : semantically valid

CF --> AS : internal state
AS --> PC : invariants hold
PC --> DB : postconditions met
PC --> FS
PC --> EA

note right of TV
  isinstance(), type hints
  "Expected str, got int"
end note

note right of RV
  0 <= value <= 100
  "Temperature out of range"
end note

note right of FV
  regex, parsing
  "Invalid email format"
end note

note right of SV
  domain rules
  "End date before start"
end note

note right of AS
  assert statements
  Debug-time checks
end note

note bottom of CF
  Trust no input
  Validate at boundaries
  Assert internal state
end note

@enduml
