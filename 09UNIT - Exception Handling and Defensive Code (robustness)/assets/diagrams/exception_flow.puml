@startuml exception_flow

!theme plain
skinparam backgroundColor #FFFFFF
skinparam activityBackgroundColor #F8F9FA
skinparam activityBorderColor #6C757D
skinparam arrowColor #0D6EFD

title Exception Propagation Flow

|#E8F4F8|Caller|
|#FFF3CD|Function|
|#F8D7DA|Exception Handler|

|Caller|
start
:call function();

|Function|
:enter try block;

if (operation succeeds?) then (yes)
    :return result;
    |Caller|
    :continue execution;
    stop
else (no)
    :exception raised;
    
    |Exception Handler|
    if (handler matches?) then (yes)
        :execute except block;
        
        if (re-raise?) then (yes)
            |Caller|
            :propagate exception;
            #pink:unhandled exception;
            stop
        else (no)
            |Function|
            :execute else block;
            :execute finally block;
            |Caller|
            :continue execution;
            stop
        endif
    else (no)
        |Function|
        :execute finally block;
        |Caller|
        :propagate exception;
        #pink:unhandled exception;
        stop
    endif
endif

@enduml
