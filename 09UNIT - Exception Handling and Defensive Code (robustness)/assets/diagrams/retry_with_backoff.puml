@startuml retry_with_backoff

!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceArrowThickness 2
skinparam noteBackgroundColor #FFF3CD

title Retry with Exponential Backoff

participant "Caller" as Caller
participant "Retry Logic" as Retry
participant "Service" as Service
participant "Timer" as Timer

Caller -> Retry : call(func)
activate Retry

loop attempt = 1 to max_attempts

    Retry -> Service : execute func()
    activate Service
    
    alt Success
        Service --> Retry : result
        deactivate Service
        Retry --> Caller : return result
        deactivate Retry
        
    else TransientError (retryable)
        Service --> Retry : raise Exception
        deactivate Service
        
        Retry -> Retry : record failure
        
        alt attempt < max_attempts
            Retry -> Retry : calculate delay\n= base × 2^(attempt-1)
            note right
              Exponential:
              1s, 2s, 4s, 8s...
              
              With jitter:
              × random(0.5, 1.0)
            end note
            
            Retry -> Timer : sleep(delay)
            activate Timer
            Timer --> Retry : wake
            deactivate Timer
            
        else attempt == max_attempts
            Retry --> Caller : raise last Exception
        end
        
    else PermanentError (non-retryable)
        Service --> Retry : raise Exception
        deactivate Service
        Retry --> Caller : raise immediately
        deactivate Retry
    end
end

note over Retry
  Key parameters:
  • max_attempts
  • base_delay
  • max_delay (cap)
  • jitter (randomisation)
  • retryable_exceptions
end note

@enduml
