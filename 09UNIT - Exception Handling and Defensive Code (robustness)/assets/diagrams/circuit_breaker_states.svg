<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <defs>
    <linearGradient id="closedGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#48bb78"/>
      <stop offset="100%" style="stop-color:#276749"/>
    </linearGradient>
    <linearGradient id="openGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f56565"/>
      <stop offset="100%" style="stop-color:#c53030"/>
    </linearGradient>
    <linearGradient id="halfOpenGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ed8936"/>
      <stop offset="100%" style="stop-color:#c05621"/>
    </linearGradient>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#48bb78"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f56565"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ed8936"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4a9eff"/>
    </marker>
    <filter id="stateShadow">
      <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.4"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="800" height="400" fill="#1a1a2e"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" fill="#eaeaea" font-family="Arial, sans-serif" font-size="20" font-weight="bold">Circuit Breaker State Machine</text>
  <text x="400" y="50" text-anchor="middle" fill="#888" font-family="Arial, sans-serif" font-size="11">Protecting services from cascading failures</text>
  
  <!-- CLOSED State -->
  <g filter="url(#stateShadow)" transform="translate(100, 150)">
    <circle cx="0" cy="0" r="60" fill="url(#closedGrad)" stroke="#48bb78" stroke-width="3"/>
    <text x="0" y="-10" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">CLOSED</text>
    <text x="0" y="10" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10">Requests</text>
    <text x="0" y="25" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10">pass through</text>
  </g>
  
  <!-- OPEN State -->
  <g filter="url(#stateShadow)" transform="translate(700, 150)">
    <circle cx="0" cy="0" r="60" fill="url(#openGrad)" stroke="#f56565" stroke-width="3"/>
    <text x="0" y="-10" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">OPEN</text>
    <text x="0" y="10" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10">Requests</text>
    <text x="0" y="25" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10">fail fast</text>
  </g>
  
  <!-- HALF_OPEN State -->
  <g filter="url(#stateShadow)" transform="translate(400, 300)">
    <circle cx="0" cy="0" r="60" fill="url(#halfOpenGrad)" stroke="#ed8936" stroke-width="3"/>
    <text x="0" y="-10" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">HALF_OPEN</text>
    <text x="0" y="10" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10">Test with</text>
    <text x="0" y="25" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10">limited traffic</text>
  </g>
  
  <!-- Transition: CLOSED → OPEN -->
  <path d="M160,130 Q400,80 640,130" fill="none" stroke="#f56565" stroke-width="3" marker-end="url(#arrowRed)"/>
  <rect x="330" y="70" width="140" height="40" rx="5" fill="#2d2d44" stroke="#f56565"/>
  <text x="400" y="88" text-anchor="middle" fill="#f56565" font-family="Arial, sans-serif" font-size="10">failures ≥ threshold</text>
  <text x="400" y="102" text-anchor="middle" fill="#888" font-family="monospace" font-size="9">(e.g., 5 failures)</text>
  
  <!-- Transition: OPEN → HALF_OPEN -->
  <path d="M660,200 Q600,280 460,290" fill="none" stroke="#ed8936" stroke-width="3" marker-end="url(#arrowOrange)"/>
  <rect x="530" y="225" width="120" height="40" rx="5" fill="#2d2d44" stroke="#ed8936"/>
  <text x="590" y="243" text-anchor="middle" fill="#ed8936" font-family="Arial, sans-serif" font-size="10">timeout elapsed</text>
  <text x="590" y="257" text-anchor="middle" fill="#888" font-family="monospace" font-size="9">(e.g., 30s)</text>
  
  <!-- Transition: HALF_OPEN → CLOSED (success) -->
  <path d="M340,290 Q220,270 140,210" fill="none" stroke="#48bb78" stroke-width="3" marker-end="url(#arrowGreen)"/>
  <rect x="170" y="240" width="130" height="40" rx="5" fill="#2d2d44" stroke="#48bb78"/>
  <text x="235" y="258" text-anchor="middle" fill="#48bb78" font-family="Arial, sans-serif" font-size="10">success threshold</text>
  <text x="235" y="272" text-anchor="middle" fill="#888" font-family="monospace" font-size="9">(e.g., 3 successes)</text>
  
  <!-- Transition: HALF_OPEN → OPEN (failure) -->
  <path d="M460,300 Q550,320 660,200" fill="none" stroke="#f56565" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="540" y="295" fill="#f56565" font-family="Arial, sans-serif" font-size="9">any failure</text>
  
  <!-- Self-loop on CLOSED (success) -->
  <path d="M55,110 A40,40 0 1,1 100,90" fill="none" stroke="#48bb78" stroke-width="2" stroke-dasharray="4,2"/>
  <text x="40" y="75" fill="#48bb78" font-family="Arial, sans-serif" font-size="9">success</text>
  
  <!-- Annotations -->
  <g transform="translate(50, 330)">
    <rect x="0" y="0" width="200" height="55" rx="5" fill="#2d2d44" stroke="#444"/>
    <text x="10" y="18" fill="#48bb78" font-family="Arial, sans-serif" font-size="10">● CLOSED: Normal operation</text>
    <text x="10" y="33" fill="#f56565" font-family="Arial, sans-serif" font-size="10">● OPEN: Fast failure mode</text>
    <text x="10" y="48" fill="#ed8936" font-family="Arial, sans-serif" font-size="10">● HALF_OPEN: Recovery probe</text>
  </g>
  
  <g transform="translate(550, 330)">
    <rect x="0" y="0" width="200" height="55" rx="5" fill="#2d2d44" stroke="#4a9eff"/>
    <text x="100" y="18" text-anchor="middle" fill="#4a9eff" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Benefits</text>
    <text x="10" y="33" fill="#aaa" font-family="Arial, sans-serif" font-size="9">• Prevents cascade failures</text>
    <text x="10" y="48" fill="#aaa" font-family="Arial, sans-serif" font-size="9">• Allows service recovery</text>
  </g>
  
  <!-- Footer -->
  <text x="400" y="395" text-anchor="middle" fill="#555" font-family="Arial, sans-serif" font-size="8">09UNIT: Exception Handling and Defensive Programming | © 2025 Antonio Clim</text>
</svg>
