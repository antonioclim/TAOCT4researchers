@startuml testing_pyramid
!theme plain
skinparam backgroundColor #0d1117
skinparam defaultFontColor #e6edf3
skinparam rectangleBackgroundColor #21262d
skinparam rectangleBorderColor #30363d

title Testing Pyramid for Research Software

' E2E Tests (top, smallest)
rectangle "**E2E Tests**\n~10%\nFew, Slow, Expensive" as e2e #f85149 {
}

' Integration Tests (middle)
rectangle "**Integration Tests**\n~20%\nComponent Interactions" as integration #d29922 {
}

' Unit Tests (base, largest)
rectangle "**Unit Tests**\n~70%\nMany, Fast, Cheap" as unit #3fb950 {
}

e2e -[hidden]down- integration
integration -[hidden]down- unit

note right of e2e
    **End-to-End Tests**
    • Full workflow validation
    • Reproduce published results
    • Compare against reference data
    • ~10% of test effort
    
    Example:
    test_full_simulation_matches_paper()
end note

note right of integration
    **Integration Tests**
    • Component interaction
    • Database connections
    • File I/O operations
    • API endpoint testing
    • ~20% of test effort
    
    Example:
    test_data_pipeline_processes_correctly()
end note

note right of unit
    **Unit Tests**
    • Individual functions
    • Edge cases
    • Error handling
    • Fast execution (<100ms)
    • ~70% of test effort
    
    Example:
    test_compute_hash_returns_correct_digest()
    test_invalid_input_raises_value_error()
end note

note bottom
    **Coverage Targets**
    
    | Metric | Target | Critical |
    |--------|--------|----------|
    | Line Coverage | ≥80% | ≥70% |
    | Branch Coverage | ≥75% | ≥60% |
    | Function Coverage | 100% | ≥90% |
    
    **Key Principle**: Test behaviour, not implementation
end note

@enduml
