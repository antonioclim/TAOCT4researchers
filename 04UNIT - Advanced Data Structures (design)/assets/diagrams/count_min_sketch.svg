<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600" width="900" height="600">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#047857;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="hashGrad1" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#60a5fa;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="hashGrad2" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#a78bfa;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="hashGrad3" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fbbf24;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
  </defs>
  
  <rect width="900" height="600" fill="#f8fafc"/>
  
  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-family="Arial, sans-serif" 
        font-size="22" font-weight="bold" fill="#1e293b">
    Count-Min Sketch: Probabilistic Frequency Estimation
  </text>
  
  <!-- Main container -->
  <g transform="translate(30, 55)">
    <rect x="0" y="0" width="840" height="520" rx="10" fill="white" filter="url(#shadow)"/>
    
    <!-- Input item -->
    <g transform="translate(30, 20)">
      <rect x="0" y="0" width="120" height="50" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
      <text x="60" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#92400e">Input Item</text>
      <text x="60" y="40" text-anchor="middle" font-family="monospace" font-size="16" font-weight="bold" fill="#1e293b">"apple"</text>
    </g>
    
    <!-- Hash functions -->
    <g transform="translate(180, 10)">
      <rect x="0" y="0" width="140" height="70" rx="8" fill="url(#hashGrad1)"/>
      <text x="70" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">h₁(x)</text>
      <text x="70" y="45" text-anchor="middle" font-family="monospace" font-size="11" fill="white">MD5 + seed₁</text>
      <text x="70" y="60" text-anchor="middle" font-family="monospace" font-size="12" fill="#bfdbfe">→ col 3</text>
    </g>
    
    <g transform="translate(350, 10)">
      <rect x="0" y="0" width="140" height="70" rx="8" fill="url(#hashGrad2)"/>
      <text x="70" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">h₂(x)</text>
      <text x="70" y="45" text-anchor="middle" font-family="monospace" font-size="11" fill="white">MD5 + seed₂</text>
      <text x="70" y="60" text-anchor="middle" font-family="monospace" font-size="12" fill="#ddd6fe">→ col 7</text>
    </g>
    
    <g transform="translate(520, 10)">
      <rect x="0" y="0" width="140" height="70" rx="8" fill="url(#hashGrad3)"/>
      <text x="70" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">h₃(x)</text>
      <text x="70" y="45" text-anchor="middle" font-family="monospace" font-size="11" fill="white">MD5 + seed₃</text>
      <text x="70" y="60" text-anchor="middle" font-family="monospace" font-size="12" fill="#fef3c7">→ col 1</text>
    </g>
    
    <!-- Arrows from input to hash functions -->
    <line x1="150" y1="45" x2="175" y2="45" stroke="#374151" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="150" y1="45" x2="175" y2="45" stroke="#374151" stroke-width="2"/>
    <path d="M 150 45 Q 165 45 180 45" stroke="#374151" stroke-width="2" fill="none"/>
    <path d="M 150 45 Q 180 35 350 45" stroke="#374151" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
    <path d="M 150 45 Q 200 25 520 45" stroke="#374151" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
    
    <!-- Counter Table (2D array) -->
    <g transform="translate(100, 110)">
      <text x="320" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1e293b">
        Counter Table (width × depth)
      </text>
      
      <!-- Column headers -->
      <text x="100" y="30" text-anchor="middle" font-family="monospace" font-size="10" fill="#64748b">0</text>
      <text x="170" y="30" text-anchor="middle" font-family="monospace" font-size="10" fill="#64748b">1</text>
      <text x="240" y="30" text-anchor="middle" font-family="monospace" font-size="10" fill="#64748b">2</text>
      <text x="310" y="30" text-anchor="middle" font-family="monospace" font-size="10" fill="#64748b">3</text>
      <text x="380" y="30" text-anchor="middle" font-family="monospace" font-size="10" fill="#64748b">4</text>
      <text x="450" y="30" text-anchor="middle" font-family="monospace" font-size="10" fill="#64748b">5</text>
      <text x="520" y="30" text-anchor="middle" font-family="monospace" font-size="10" fill="#64748b">6</text>
      <text x="590" y="30" text-anchor="middle" font-family="monospace" font-size="10" fill="#64748b">7</text>
      
      <!-- Row 0 (h₁) -->
      <text x="45" y="63" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#3b82f6">h₁</text>
      <rect x="65" y="40" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="95" y="63" text-anchor="middle" font-family="monospace" font-size="14">2</text>
      <rect x="135" y="40" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="165" y="63" text-anchor="middle" font-family="monospace" font-size="14">0</text>
      <rect x="205" y="40" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="235" y="63" text-anchor="middle" font-family="monospace" font-size="14">1</text>
      <rect x="275" y="40" width="60" height="35" fill="#bfdbfe" stroke="#3b82f6" stroke-width="3"/>
      <text x="305" y="63" text-anchor="middle" font-family="monospace" font-size="14" font-weight="bold" fill="#1d4ed8">5</text>
      <rect x="345" y="40" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="375" y="63" text-anchor="middle" font-family="monospace" font-size="14">3</text>
      <rect x="415" y="40" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="445" y="63" text-anchor="middle" font-family="monospace" font-size="14">0</text>
      <rect x="485" y="40" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="515" y="63" text-anchor="middle" font-family="monospace" font-size="14">4</text>
      <rect x="555" y="40" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="585" y="63" text-anchor="middle" font-family="monospace" font-size="14">1</text>
      
      <!-- Row 1 (h₂) -->
      <text x="45" y="103" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#8b5cf6">h₂</text>
      <rect x="65" y="80" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="95" y="103" text-anchor="middle" font-family="monospace" font-size="14">1</text>
      <rect x="135" y="80" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="165" y="103" text-anchor="middle" font-family="monospace" font-size="14">3</text>
      <rect x="205" y="80" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="235" y="103" text-anchor="middle" font-family="monospace" font-size="14">0</text>
      <rect x="275" y="80" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="305" y="103" text-anchor="middle" font-family="monospace" font-size="14">2</text>
      <rect x="345" y="80" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="375" y="103" text-anchor="middle" font-family="monospace" font-size="14">0</text>
      <rect x="415" y="80" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="445" y="103" text-anchor="middle" font-family="monospace" font-size="14">1</text>
      <rect x="485" y="80" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="515" y="103" text-anchor="middle" font-family="monospace" font-size="14">2</text>
      <rect x="555" y="80" width="60" height="35" fill="#ddd6fe" stroke="#8b5cf6" stroke-width="3"/>
      <text x="585" y="103" text-anchor="middle" font-family="monospace" font-size="14" font-weight="bold" fill="#6d28d9">7</text>
      
      <!-- Row 2 (h₃) -->
      <text x="45" y="143" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#f59e0b">h₃</text>
      <rect x="65" y="120" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="95" y="143" text-anchor="middle" font-family="monospace" font-size="14">0</text>
      <rect x="135" y="120" width="60" height="35" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/>
      <text x="165" y="143" text-anchor="middle" font-family="monospace" font-size="14" font-weight="bold" fill="#92400e">5</text>
      <rect x="205" y="120" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="235" y="143" text-anchor="middle" font-family="monospace" font-size="14">4</text>
      <rect x="275" y="120" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="305" y="143" text-anchor="middle" font-family="monospace" font-size="14">1</text>
      <rect x="345" y="120" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="375" y="143" text-anchor="middle" font-family="monospace" font-size="14">3</text>
      <rect x="415" y="120" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="445" y="143" text-anchor="middle" font-family="monospace" font-size="14">0</text>
      <rect x="485" y="120" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="515" y="143" text-anchor="middle" font-family="monospace" font-size="14">2</text>
      <rect x="555" y="120" width="60" height="35" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
      <text x="585" y="143" text-anchor="middle" font-family="monospace" font-size="14">0</text>
      
      <!-- Query result -->
      <g transform="translate(0, 180)">
        <rect x="200" y="0" width="240" height="60" rx="10" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
        <text x="320" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#166534">
          Query("apple") = min(5, 7, 5)
        </text>
        <text x="320" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#166534">
          Estimated count: 5
        </text>
      </g>
    </g>
    
    <!-- Parameter explanation -->
    <g transform="translate(30, 370)">
      <rect x="0" y="0" width="380" height="130" rx="8" fill="#f0f9ff" stroke="#0ea5e9" stroke-width="1"/>
      <text x="190" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#0369a1">
        Parameters and Guarantees
      </text>
      
      <text x="15" y="48" font-family="Arial, sans-serif" font-size="11" fill="#374151">
        <tspan font-weight="bold">Width (w)</tspan> = ⌈e/ε⌉ — controls error magnitude
      </text>
      <text x="15" y="68" font-family="Arial, sans-serif" font-size="11" fill="#374151">
        <tspan font-weight="bold">Depth (d)</tspan> = ⌈ln(1/δ)⌉ — controls success probability
      </text>
      <text x="15" y="92" font-family="Arial, sans-serif" font-size="11" fill="#374151">
        <tspan font-weight="bold">Error bound:</tspan> estimate ≤ true + εN
      </text>
      <text x="15" y="112" font-family="Arial, sans-serif" font-size="11" fill="#374151">
        <tspan font-weight="bold">Probability:</tspan> 1 - δ (bounds hold)
      </text>
    </g>
    
    <!-- Key properties -->
    <g transform="translate(430, 370)">
      <rect x="0" y="0" width="380" height="130" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
      <text x="190" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#92400e">
        Key Properties
      </text>
      
      <text x="15" y="48" font-family="Arial, sans-serif" font-size="11" fill="#374151">
        ✓ <tspan font-weight="bold">Never underestimates</tspan> — query ≥ true count
      </text>
      <text x="15" y="68" font-family="Arial, sans-serif" font-size="11" fill="#374151">
        ✓ <tspan font-weight="bold">Space efficient</tspan> — O(1/ε · log(1/δ)) regardless of N
      </text>
      <text x="15" y="88" font-family="Arial, sans-serif" font-size="11" fill="#374151">
        ✓ <tspan font-weight="bold">Mergeable</tspan> — supports distributed counting
      </text>
      <text x="15" y="108" font-family="Arial, sans-serif" font-size="11" fill="#374151">
        ✓ <tspan font-weight="bold">Streaming</tspan> — single pass, constant time updates
      </text>
    </g>
  </g>
  
  <!-- Footer with complexity -->
  <text x="450" y="588" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#64748b">
    Update: O(d)  |  Query: O(d)  |  Space: O(w × d)  |  where d = O(log 1/δ), w = O(1/ε)
  </text>
</svg>
